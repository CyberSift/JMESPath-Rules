[
  {
    "title": "O365 Suspicious Inbox Rule Created or Modified (MarkAsRead)",
    "expression": "contains(['New-InboxRule', 'Set-InboxRule'], o365.audit.Operation) && to_string(o365.audit.Parameters.MarkAsRead)=='True'",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "O365 Suspicious Inbox Rule Created or Modified (Suspicious Folder)",
    "expression": "contains(['New-InboxRule', 'Set-InboxRule'], o365.audit.Operation) && (contains(to_string(o365.audit.Parameters.MoveToFolder), 'RSS') || contains(to_string(o365.audit.Parameters.MoveToFolder), 'Archive'))",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "O365 Mailbox Audit Logging Bypass",
    "expression": "event.dataset == 'o365.audit' && event.provider == 'Exchange' && event.action == 'Set-MailboxAuditBypassAssociation' && event.outcome == 'success'",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "O365 Exchange Transport Rule Creation",
    "expression": "event.dataset == 'o365.audit' && event.provider == 'Exchange' && event.category == 'web' && event.action == 'New-TransportRule' && event.outcome == 'success'",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "O365 User Login with Suspicious User Agent",
    "expression": "o365.audit.Operation == 'UserLoggedIn' && o365.audit.ExtendedProperties.UserAgent != null && (!starts_with(to_string(o365.audit.ExtendedProperties.UserAgent), 'Mozilla') && !starts_with(to_string(o365.audit.ExtendedProperties.UserAgent), 'Windows-AzureAD-Authentication-Provider') && !starts_with(to_string(o365.audit.ExtendedProperties.UserAgent), 'BAV2ROPC') && !starts_with(to_string(o365.audit.ExtendedProperties.UserAgent), 'AppSSOAgent'))",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "Excessive O365 Mailbox Items Accessed",
    "expression": "event.dataset == 'o365.audit' && event.provider == 'Exchange' && event.action == 'MailItemsAccessed' && event.code == 'ExchangeItemAggregated' && ((contains(to_string(o365.audit.OperationProperties[].Name), 'IsThrottled') && contains(to_string(o365.audit.OperationProperties[].Value), 'True')) || o365.audit.OperationCount >= `100`)",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "O365 Sharing Abuse from VPS",
    "expression": "(o365.audit.Operation == 'SharingSet' || o365.audit.Operation == 'AddToSecureLink' || o365.audit.Operation == 'SecureLinkCreated') && (\"cybersift.threat_info\".usageType == 'hosting') && !(o365.audit.UserId == 'app@sharepoint' || source.as.organization.name == 'MICROSOFT-CORP-MSN-AS-BLOCK') && o365.audit.AuthenticationType=='FormsCookieAuth'",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "O365 Login to High-Risk Admin Application from VPS",
    "expression": "((o365.audit.Operation == 'UserLoggedIn' || o365.audit.LogonError == 'UserStrongAuthClientAuthNRequiredInterrupt') && cybersift.threat_info.usageType == 'hosting') && ((contains(to_string(o365.cybersift.application), 'Azure') || contains(to_string(o365.cybersift.application), 'Admin')) && (source.as.organization.name != 'MICROSOFT-CORP-MSN-AS-BLOCK'))",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "Possible Password Leak â€“ Failed MFA from Non-Standard Browser",
    "expression": "event.action == 'UserLoginFailed' && o365.audit.LogonError == 'UserStrongAuthClientAuthNRequiredInterrupt' && cybersift.DeviceProperties.BrowserType == 'Other'",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "Known Threat O365 User Login Attempt",
    "expression": "event.action == 'UserLoggedIn' && to_string(cybersift.threat_info.knownThreat) == 'true' && (o365.audit.ExtendedProperties.RequestType == 'OAuth2:Token' || o365.audit.ExtendedProperties.RequestType == 'Login:login')",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "Suspicious login from BAV2ROPC User Agent",
    "expression": "o365.audit.ExtendedProperties.UserAgent=='BAV2ROPC' && o365.audit.ExtendedProperties.RequestType=='OAuth2:Token' && to_string(o365.audit.ExtendedProperties.UserAuthenticationMethod)=='16' && source.as.organization.name!='MICROSOFT-CORP-MSN-AS-BLOCK' && o365.audit.ResultStatus!='Failed'",
    "severity": "high",
    "type": "o365"
  },
  {
    "title": "O365 Activity from Tor IP Address",
    "expression": "o365.audit.Operation!='UserLoginFailed' && contains(to_string("cybersift.threat_info".threats), 'Tor')",
    "severity": "high",
    "type": "o365"
  }
]
