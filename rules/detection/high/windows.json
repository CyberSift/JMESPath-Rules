[
  {
    "title": "Non-existent wordlist user login",
    "expression": "to_string(event.code) == '4625' && winlog.event_data.SubStatus=='0xc0000064' && contains(['ftpuser', 'backup', 'operator', 'superuser'], winlog.cybersift.TargetUserNameNormalized)",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Well known credential dumping tool use",
    "expression": "to_string(event.code) == '4697' && (contains(winlog.event_data.ServiceFileName, 'cachedump')|| contains(winlog.event_data.ServiceFileName, 'dumpsvc')|| contains(winlog.event_data.ServiceFileName, 'fgexec')|| contains(winlog.event_data.ServiceFileName, 'gsecdump')|| contains(winlog.event_data.ServiceFileName, 'mimidrv')|| contains(winlog.event_data.ServiceFileName, 'pwdump')|| contains(winlog.event_data.ServiceFileName, 'servpw'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "NULL SID Login",
    "expression": "contains(Abnormalities || '', 'AbnormalLogin_NULLSID')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Abnormal Login Source Workstation by High Privilege User",
    "expression": "contains(Abnormalities || '', 'AbnormalLoginSource_Workstation_High_Privilege_User')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Administrator Login - direct administrator logins should be disabled",
    "expression": "(to_string(event.code) == '4624'|| to_string(event.code) == '4625') && contains(['2', '10'], winlog.event_data.LogonType) && winlog.event_data.TargetUserNameNormalized=='administrator'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "PowerShell Remote Code Execution via Web Clients",
    "expression": "(   contains(to_string(winlog.event_data.ParentProcessName), 'powershell.exe') ||   contains(to_string(winlog.event_data.NewProcessName), 'powershell.exe') ||   contains(to_string(winlog.event_data.ProcessName), 'powershell.exe') ||   contains(to_string(winlog.event_data.CommandLine), 'powershell.exe') ) && (   contains(to_string(winlog.event_data.CommandLine), 'IEX') ||   contains(to_string(winlog.event_data.CommandLine), 'Invoke-WebRequest') ||   contains(to_string(winlog.event_data.CommandLine), 'DownloadString') ||   contains(to_string(winlog.event_data.CommandLine), 'curl') ||   contains(to_string(winlog.event_data.CommandLine), 'wget') ||   contains(to_string(winlog.event_data.CommandLine), 'certutil') ||   contains(to_string(winlog.event_data.CommandLine), 'Net.WebClient') )",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Suspicious Scheduled Task Creation",
    "expression": "to_string(event.code) == '4698' && (contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'cmd.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'wscript.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'rundll32.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'regsvr32.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'wmic.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'mshta.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'powershell.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'bitsadmin.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'wget.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'cscript.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'certutil.exe')) && !contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Arguments), '%windir%\\\\system32') && !contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Arguments), '%systemroot%\\\\system32\\\\hpatchmonTask.cmd')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Persistence via Run Keys",
    "expression": "to_string(event.code) == '4657' && (contains(to_string(winlog.event_data.ProcessName), 'powershell.exe') || contains(to_string(winlog.event_data.ProcessName), 'mshta.exe') || contains(to_string(winlog.event_data.ProcessName), 'wscript.exe')) && contains(to_string(winlog.event_data.ObjectName), 'Run')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Enumeration of Privileged Domain Groups",
    "expression": "to_string(event.code) == '4688' && (ends_with(to_string(winlog.event_data.NewProcessName), 'net.exe') || ends_with(to_string(winlog.event_data.NewProcessName), 'net1.exe')) && (contains(to_string(winlog.event_data.CommandLine), 'Admins') || contains(to_string(winlog.event_data.CommandLine), 'admins'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Windows Defender Bypass via PowerShell",
    "expression": "to_string(event.code) == '4688' && contains(to_string(winlog.event_data.NewProcessName), 'powershell.exe') && (contains(to_string(winlog.event_data.CommandLine), 'Add-MpPreference') || contains(to_string(winlog.event_data.CommandLine), 'Set-MpPreference'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Suspicious Execution in User Writable Paths",
    "expression": "to_string(event.code) == '4663' && winlog.event_data.AccessMask == '0x20' && (contains(to_string(winlog.event_data.ObjectName), 'AppData\\Local\\Temp') || contains(to_string(winlog.event_data.ObjectName), 'AppData\\Roaming') || contains(to_string(winlog.event_data.ObjectName), 'Users\\Public'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Resource-Based Constrained Delegation Abuse",
    "expression": "to_string(event.code) == '5136' && winlog.event_data.AttributeLDAPDisplayName == 'msDS-AllowedToActOnBehalfOfOtherIdentity'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Unusual Kerberos TicketOptions",
    "expression": "(to_string(event.code) == '4771' || to_string(event.code) == '4768' || to_string(event.code) == '4769') && (to_string(winlog.event_data.TicketOptions) == '0x50800000' || to_string(winlog.event_data.TicketOptions) == '0x40830000')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "SAM Privilege Usage",
    "expression": "to_string(event.code) == '4673' && winlog.event_data.PrivilegeList == 'SeMachineAccountPrivilege' && winlog.event_data.Service == 'Security Account Manager'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Odbcconf Abuse for DLL or RSP Execution",
    "expression": "to_string(event.code) == '4688' && (ends_with(to_string(winlog.event_data.ParentProcessName), 'odbcconf.exe') || ends_with(to_string(winlog.event_data.NewProcessName), 'odbcconf.exe')) && (contains(to_string(winlog.event_data.CommandLine), '.dll') || contains(to_string(winlog.event_data.CommandLine), '.rsp') || contains(to_string(winlog.event_data.CommandLine), 'REGSVR'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "userCertificate Modifications by SYSTEM",
    "expression": "to_string(event.code) == '5136' && winlog.event_data.AttributeLDAPDisplayName=='userCertificate' && winlog.cybersift.SubjectUserType=='user' && winlog.cybersift.SubjectUserNameNormalized=='system'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Kerberos TGS Request RC4 Encryption",
    "expression": "to_string(event.code) == '4769' && winlog.event_data.TargetUserType == 'user' && winlog.event_data.SessionKeyEncryptionType == '0x17'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Potential Kerberos Delegation or Coerced Authentication Detected",
    "expression": "to_string(event.code) == '4769' && winlog.event_data.TransmittedServices != null && to_string(winlog.event_data.TransmittedServices) != '-'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "User Account Created with Password Not Required",
    "expression": "to_string(event.code) == '4741' && winlog.event_data.NewUacValue == '0x84'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "WSUS RCE Process Spawn",
    "expression": "to_string(event.code) == '4688' && (ends_with(to_string(winlog.event_data.ParentProcessName),'w3wp.exe') || ends_with(to_string(winlog.event_data.ParentProcessName),'wsusservice.exe')) && (ends_with(to_string(winlog.event_data.NewProcessName),'cmd.exe') || ends_with(to_string(winlog.event_data.NewProcessName),'powershell.exe'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Kerberos Constrained Delegation Configured",
    "expression": "winlog.event_data.AllowedToDelegateTo != null && to_string(winlog.event_data.AllowedToDelegateTo) != '-'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "C$ Share Access by Administrator Account",
    "expression": "(to_string(event.code) == '5140' || to_string(event.code) == '5145') && to_string(winlog.event_data.ShareName) == '\\\\*\\C$' && winlog.cybersift.SubjectUserNameNormalized == 'administrator' && to_string(winlog.event_data.IpAddress) != '::1'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Access to Administrative Script Shares",
    "expression": "to_string(event.code) == '5140' && (ends_with(to_string(winlog.event_data.ShareName), 'env_variables_oracle_permission_script') || ends_with(to_string(winlog.event_data.ShareName), 'Tasks') || ends_with(to_string(winlog.event_data.ShareName), 'GPO Installations') || ends_with(to_string(winlog.event_data.ShareName), 'scripts'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Unusual RPC Access to Sensitive Shares via SMB",
    "expression": "to_string(event.code) == '5145' && ends_with(to_string(winlog.event_data.ShareName), 'IPC$') && (to_string(winlog.event_data.RelativeTargetName) == 'DAV RPC Service' || to_string(winlog.event_data.RelativeTargetName) == 'svcctl' || to_string(winlog.event_data.RelativeTargetName) == 'cert' || to_string(winlog.event_data.RelativeTargetName) == 'lsass')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "GPO Access by Non-Admin User",
    "expression": "to_string(event.code) == '4662' && winlog.cybersift.SubjectUserType == 'user' && winlog.event_data.ObjectServer == 'DS' && winlog.cybersift.KerberosObjectType == 'c-grouppolicycontainer'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "PowerShell Suspicious Download and Extraction",
    "expression": "to_string(event.code) == '4104' && (contains(to_string(winlog.event_data.ScriptBlockText), 'certutil') || contains(to_string(winlog.event_data.ScriptBlockText), 'curl') || contains(to_string(winlog.event_data.ScriptBlockText), 'wget') || contains(to_string(winlog.event_data.ScriptBlockText), 'bitsadmin') || contains(to_string(winlog.event_data.ScriptBlockText), 'Start-BitsTransfer') || contains(to_string(winlog.event_data.ScriptBlockText), 'DownloadFile') || contains(to_string(winlog.event_data.ScriptBlockText), 'Invoke-WebRequest') || contains(to_string(winlog.event_data.ScriptBlockText), 'iwr')) && (contains(to_string(winlog.event_data.ScriptBlockText), 'Expand-Archive') || contains(to_string(winlog.event_data.ScriptBlockText), 'expand-archive'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "AutoIt3 Execution",
    "expression": "to_string(event.code) == '4688' && (ends_with(to_string(winlog.event_data.NewProcessName), 'AutoIt3.exe') || ends_with(to_string(winlog.event_data.ParentProcessName), 'AutoIt3.exe') || contains(to_string(winlog.event_data.CommandLine), '.au3') || contains(to_string(winlog.event_data.CommandLine), 'autoit'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Windows Security Audit Policy Tampering",
    "expression": "to_string(event.code) == '4688' && ends_with(to_string(winlog.event_data.NewProcessName), 'auditpol.exe') && winlog.event_data.SubjectUserSid != 'S-1-5-18'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Service Creation In Users Public Directory",
    "expression": "to_string(event.code) == '4697' && contains(to_string(winlog.event_data.ServiceFileName), 'Public')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Suspicious Screenshots captures via PowerShell script",
    "expression": "to_string(event.code) == '4104' && (contains(to_string(winlog.event_data.ScriptBlockText), 'CopyFromScreen') && (contains(to_string(winlog.event_data.ScriptBlockText), 'System.Drawing.Bitmap') || contains(to_string(winlog.event_data.ScriptBlockText), 'Drawing.Bitmap')))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Suspicious Access to Confidential AD Attributes",
    "expression": "to_string(event.code) == '4662' && winlog.cybersift.SubjectUserType == 'user' && contains(to_string(winlog.cybersift.KerberosRequestedAccessList), 'a-unixuserpassword') && contains(to_string(winlog.cybersift.KerberosRequestedAccessList), 'c-user') && !contains(to_string(winlog.cybersift.KerberosRequestedAccessList), 'a-mspkiroamingtimestamp') && (to_string(winlog.event_data.AccessMask) == '0x100' || to_string(winlog.event_data.AccessMask) == '0x40000')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Persistence via Startup folder",
    "expression": "to_string(event.code) == '4663' && contains(to_string(winlog.event_data.ObjectName), '\\\\Programs\\\\Startup\\\\') && (contains(to_string(winlog.cybersift.AccessList), 'WriteData') || contains(to_string(winlog.cybersift.AccessList), 'AppendData')) && !ends_with(to_string(winlog.event_data.ObjectName), 'desktop.ini')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "PsExec Remote Service Execution",
    "expression": "(to_string(event.code) == '7045' && winlog.event_data.ServiceName == 'PSEXESVC') || (to_string(event.code) == '4657' && contains(to_string(winlog.event_data.ObjectName), 'PsExec')) || (to_string(event.code) == '4688' && ends_with(to_string(winlog.event_data.ParentProcessName), 'PSEXESVC.exe')) || (to_string(event.code) == '5145' && ends_with(to_string(winlog.event_data.ShareName), 'IPC$') && (contains(to_string(winlog.event_data.RelativeTargetName), 'stdin') || contains(to_string(winlog.event_data.RelativeTargetName), 'stderr') || contains(to_string(winlog.event_data.RelativeTargetName), 'stdout')))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "NotepadPP GUP Suspicious ChildProcesses",
    "expression": "to_string(event.code) == '4688' && ends_with(to_string(winlog.event_data.ParentProcessName),'GUP.exe') && winlog.event_data.NewProcessName!='C:\\\\Windows\\\\explorer.exe' && winlog.event_data.NewProcessName!='C:\\\\Program Files\\\\Notepad++\\\\updater\\\\GUP.exe'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Svchost Masquerading",
    "expression": "to_string(event.code) == '4688' && ends_with(to_string(winlog.event_data.NewProcessName), 'svchost.exe') && winlog.event_data.NewProcessName != 'C:\\\\Windows\\\\System32\\\\svchost.exe' && winlog.event_data.NewProcessName != 'C:\\\\Windows\\\\SysWOW64\\\\svchost.exe'",
    "severity": "high",
    "type": "windows"
  }
]
