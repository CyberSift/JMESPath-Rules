[
  {
    "title": "Non-existent wordlist user login",
    "expression": "to_string(event.code) == '4625' && winlog.event_data.SubStatus=='0xc0000064' && contains(['ftpuser', 'backup', 'operator', 'superuser'], winlog.cybersift.TargetUserNameNormalized)",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Well known credential dumping tool use",
    "expression": "to_string(event.code) == '4697' && (contains(winlog.event_data.ServiceFileName, 'cachedump')|| contains(winlog.event_data.ServiceFileName, 'dumpsvc')|| contains(winlog.event_data.ServiceFileName, 'fgexec')|| contains(winlog.event_data.ServiceFileName, 'gsecdump')|| contains(winlog.event_data.ServiceFileName, 'mimidrv')|| contains(winlog.event_data.ServiceFileName, 'pwdump')|| contains(winlog.event_data.ServiceFileName, 'servpw'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "NULL SID Login",
    "expression": "contains(Abnormalities || '', 'AbnormalLogin_NULLSID')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Abnormal Login Source Workstation by High Privilege User",
    "expression": "contains(Abnormalities || '', 'AbnormalLoginSource_Workstation_High_Privilege_User')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Administrator Login - direct administrator logins should be disabled",
    "expression": "(to_string(event.code) == '4624'|| to_string(event.code) == '4625') && contains(['2', '10'], winlog.event_data.LogonType) && winlog.event_data.TargetUserNameNormalized=='administrator'",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "PowerShell Remote Code Execution via Web Clients",
    "expression": "(   contains(to_string(winlog.event_data.ParentProcessName), 'powershell.exe') ||   contains(to_string(winlog.event_data.NewProcessName), 'powershell.exe') ||   contains(to_string(winlog.event_data.ProcessName), 'powershell.exe') ||   contains(to_string(winlog.event_data.CommandLine), 'powershell.exe') ) && (   contains(to_string(winlog.event_data.CommandLine), 'IEX') ||   contains(to_string(winlog.event_data.CommandLine), 'Invoke-WebRequest') ||   contains(to_string(winlog.event_data.CommandLine), 'DownloadString') ||   contains(to_string(winlog.event_data.CommandLine), 'curl') ||   contains(to_string(winlog.event_data.CommandLine), 'wget') ||   contains(to_string(winlog.event_data.CommandLine), 'certutil') ||   contains(to_string(winlog.event_data.CommandLine), 'Net.WebClient') )",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Suspicious Scheduled Task Creation",
    "expression": "to_string(event.code) == '4698' && (contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'cmd.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'wscript.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'rundll32.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'regsvr32.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'wmic.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'mshta.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'powershell.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'bitsadmin.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'wget.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'cscript.exe') || contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Command), 'certutil.exe')) && !contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Arguments), '%windir%\\\\system32') && !contains(to_string(winlog.cybersift.TaskContent.Task.Actions.Exec.Arguments), '%systemroot%\\\\system32\\\\hpatchmonTask.cmd')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Persistence via Run Keys",
    "expression": "to_string(event.code) == '4657' && (contains(to_string(winlog.event_data.ProcessName), 'powershell.exe') || contains(to_string(winlog.event_data.ProcessName), 'mshta.exe') || contains(to_string(winlog.event_data.ProcessName), 'wscript.exe')) && contains(to_string(winlog.event_data.ObjectName), 'Run')",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Enumeration of Privileged Domain Groups",
    "expression": "to_string(event.code) == '4688' && (ends_with(to_string(winlog.event_data.NewProcessName), 'net.exe') || ends_with(to_string(winlog.event_data.NewProcessName), 'net1.exe')) && (contains(to_string(winlog.event_data.CommandLine), 'Admins') || contains(to_string(winlog.event_data.CommandLine), 'admins'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Windows Defender Bypass via PowerShell",
    "expression": "to_string(event.code) == '4688' && contains(to_string(winlog.event_data.NewProcessName), 'powershell.exe') && (contains(to_string(winlog.event_data.CommandLine), 'Add-MpPreference') || contains(to_string(winlog.event_data.CommandLine), 'Set-MpPreference'))",
    "severity": "high",
    "type": "windows"
  },
  {
    "title": "Suspicious Execution in User Writable Paths",
    "expression": "to_string(event.code) == '4663' && winlog.event_data.AccessMask == '0x20' && (contains(to_string(winlog.event_data.ObjectName), 'AppData\Local\Temp') || contains(to_string(winlog.event_data.ObjectName), 'AppData\Roaming') || contains(to_string(winlog.event_data.ObjectName), 'Users\Public'))",
    "severity": "high",
    "type": "windows"
  }
]
